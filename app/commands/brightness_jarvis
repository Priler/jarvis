import speech_recognition as sr
import pyttsx3
import screen_brightness_control as sbc
import re

# --- Голосовая озвучка ---
engine = pyttsx3.init()
engine.setProperty('rate', 170)

def speak(text):
    print(f"Jarvis: {text}")
    engine.say(text)
    engine.runAndWait()

# --- Голосовое распознавание ---
def listen():
    recognizer = sr.Recognizer()
    with sr.Microphone() as source:
        print("Слушаю...")
        audio = recognizer.listen(source)
    try:
        command = recognizer.recognize_google(audio, language="ru-RU").lower()
        print(f"Вы сказали: {command}")
        return command
    except:
        speak("Не расслышал. Повтори.")
        return ""

# --- Управление яркостью ---
def increase_brightness():
    try:
        sbc.set_brightness('+10')
        speak("Увеличил яркость.")
    except:
        speak("Ошибка при увеличении яркости.")

def decrease_brightness():
    try:
        sbc.set_brightness('-10')
        speak("Уменьшил яркость.")
    except:
        speak("Ошибка при уменьшении яркости.")

def set_brightness_to_number(command):
    match = re.search(r'\d{1,3}', command)
    if match:
        brightness = int(match.group())
        if 0 <= brightness <= 100:
            try:
                sbc.set_brightness(brightness)
                speak(f"Установил яркость на {brightness} процентов.")
            except:
                speak("Не удалось установить яркость.")
        else:
            speak("Число должно быть от 0 до 100.")
    else:
        speak("Скажи, на сколько процентов установить яркость.")

# --- Главный цикл ---
speak("Джарвис запущен. Готов менять яркость.")

while True:
    command = listen()

    if "стоп" in command or "выключись" in command:
        speak("Отключаюсь.")
        break

    elif "увеличь яркость" in command or "сделай ярче" in command:
        increase_brightness()

    elif "уменьши яркость" in command or "сделай тусклее" in command:
        decrease_brightness()

    elif "установи яркость" in command:
        set_brightness_to_number(command)

    else:
        speak("Команда не распознана.")
